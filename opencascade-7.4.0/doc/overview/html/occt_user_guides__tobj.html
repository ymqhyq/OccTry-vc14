<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Open CASCADE Technology: TObj Package</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="occ_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Open CASCADE Technology
   &#160;<span id="projectnumber">7.4.0.beta</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('occt_user_guides__tobj.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">TObj Package </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#occt_tobj_1">Introduction</a><ul><li class="level2"><a href="#occt_tobj_1_1">Applicability</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_tobj_2">TObj Model</a><ul><li class="level2"><a href="#occt_tobj_2_1">TObj Model structure</a></li>
<li class="level2"><a href="#occt_tobj_2_2">Data Model basic features</a></li>
<li class="level2"><a href="#occt_tobj_2_3">Model Persistence</a></li>
<li class="level2"><a href="#occt_tobj_2_4">Access to the objects in the model</a></li>
<li class="level2"><a href="#occt_tobj_2_5">Own model data</a></li>
<li class="level2"><a href="#occt_tobj_2_6">Object naming</a></li>
<li class="level2"><a href="#occt_tobj_2_7">API for transaction mechanism</a></li>
<li class="level2"><a href="#occt_tobj_28">Model format and version</a></li>
<li class="level2"><a href="#occt_tobj_2_9">Model update</a></li>
<li class="level2"><a href="#occt_tobj_2_10">Model copying</a></li>
<li class="level2"><a href="#occt_tobj_2_11">Messaging</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_tobj_3">Model object</a><ul><li class="level2"><a href="#occt_tobj_3_1">Separation of data and interface</a></li>
<li class="level2"><a href="#occt_tobj_3_2">Basic features</a></li>
<li class="level2"><a href="#occt_tobj_3_3">Data layout and inheritance</a></li>
<li class="level2"><a href="#occt_tobj_3_4">Persistence</a></li>
<li class="level2"><a href="#occt_tobj_3_5">Names of objects</a></li>
<li class="level2"><a href="#occt_tobj_3_6">References between objects</a></li>
<li class="level2"><a href="#occt_tobj_3_7">Creation and deletion of objects</a></li>
<li class="level2"><a href="#occt_tobj_3_8">Transformation and replication of object data</a></li>
<li class="level2"><a href="#occt_tobj_3_9">Object flags</a></li>
<li class="level2"><a href="#occt_tobj_310">Partitions</a></li>
</ul>
</li>
<li class="level1"><a href="#occt_tobj_4">Auxiliary classes</a></li>
<li class="level1"><a href="#occt_tobj_5">Packaging</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="occt_tobj_1"></a>
Introduction</h1>
<p>This document describes the package TObj, which is an add-on to the Open CASCADE Application Framework (OCAF).</p>
<p>This package provides a set of classes and auxiliary tools facilitating the creation of object-oriented data models on top of low-level OCAF data structures. This includes:</p>
<ul>
<li>Definition of classes representing data objects. Data objects store their data using primitive OCAF attributes, taking advantage of OCAF mechanisms for Undo/Redo and persistence. At the same time they provide a higher level abstraction over the pure OCAF document structure (labels / attributes).</li>
<li>Organization of the data model as a hierarchical (tree-like) structure of objects.</li>
<li>Support of cross-references between objects within one model or among different models. In case of cross-model references the models should depend hierarchically.</li>
<li>Persistence mechanism for storing <em>TObj</em> objects in OCAF files, which allows storing and retrieving objects of derived types without writing additional code to support persistence.</li>
</ul>
<p>This document describes basic principles of logical and physical organization of TObj-based data models and typical approaches to implementation of classes representing model objects.</p>
<h2><a class="anchor" id="occt_tobj_1_1"></a>
Applicability</h2>
<p>The main purpose of the <em>TObj</em> data model is rapid development of the object-oriented data models for applications, using the existing functionality provided by OCAF (Undo/Redo and persistence) without the necessity to redevelop such functionality from scratch.</p>
<p>As opposed to using bare OCAF (at the level of labels and attributes), TObj facilitates dealing with higher level abstracts, which are closer to the application domain. It works best when the application data are naturally organized in hierarchical structures, and is especially useful for complex data models with dependencies between objects belonging to different parts of the model.</p>
<p>It should be noted that <em>TObj</em> is efficient for representing data structures containing a limited number of objects at each level of the data structure (typically less than 1000). A greater number of objects causes performance problems due to list-based organization of OCAF documents. Therefore, other methods of storage, such as arrays, are advisable for data models or their sub-parts containing a great number of uniform objects. However, these methods can be combined with the usage of <em>TObj</em> to represent the high-level structure of the model.</p>
<h1><a class="anchor" id="occt_tobj_2"></a>
TObj Model</h1>
<h2><a class="anchor" id="occt_tobj_2_1"></a>
TObj Model structure</h2>
<p>In the <em>TObj</em> data model the data are separated from the interfaces that manage them.</p>
<p>It should be emphasized that <em>TObj</em> package defines only the interfaces and the basic structure of the model and objects, while the actual contents and structure of the model of a particular application are defined by its specific classes inherited from <em>TObj</em> classes. The implementation can add its own features or even change the default behaviour and the data layout, though this is not recommended.</p>
<p>Logically the <em>TObj</em> data model is represented as a tree of model objects, with upper-level objects typically being collections of other objects (called <em>partitions</em>, represented by the class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___partition.html">TObj_Partition</a></em>). The root object of the model is called the <em>Main partition</em> and is maintained by the model itself. This partition contains a list of sub-objects called its <em>children</em> each sub-object may contain its own children (according to its type), etc.</p>
<div class="image">
<img src="tobj_image003.png" alt="tobj_image003.png"/>
<div class="caption">
TObj Data Model</div></div>
<p> As the <em>TObj</em> Data Model is based on OCAF (Open CASCADE Application Framework) technology, it stores its data in the underlying OCAF document. The OCAF document consists of a tree of items called <em>labels</em>. Each label has some data attached to it in the form of <em>attributes</em>, and may contain an arbitrary number of sub-labels. Each sub-label is identified by its sequential number called the <em>tag</em>. The complete sequence of tag numbers of the label and its parents starting from the document root constitutes the complete <em>entry</em> of the label, which uniquely identifies its position in the document.</p>
<p>Generally the structure of the OCAF tree of the <em>TObj</em> data model corresponds to the logical structure of the model and can be presented as in the following picture:</p>
<div class="image">
<img src="tobj_image004.png" alt="tobj_image004.png"/>
<div class="caption">
TObj Data Model mapped on OCAF document</div></div>
<p> All data of the model are stored in the root label (0:1) of the OCAF document. An attribute <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_model.html">TObj_TModel</a></em> is located in this root label. It stores the object of type <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a></em>. This object serves as a main interface tool to access all data and functionalities of the data model.</p>
<p>In simple cases all data needed by the application may be contained in a single data model. Moreover, <em>TObj</em> gives the possibility to distribute the data between several interconnected data models. This can be especially useful for the applications dealing with great amounts of data. because only the data required for the current operation is loaded in the memory at one time. It is presumed that the models have a hierarchical (tree-like) structure, where the objects of the child models can refer to the objects of the parent models, not vice-versa. Provided that the correct order of loading and closing of the models is ensured, the <em>TObj</em> classes will maintain references between the objects automatically.</p>
<h2><a class="anchor" id="occt_tobj_2_2"></a>
Data Model basic features</h2>
<p>The class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a></em> describing the data model provides the following functionalities:</p>
<ul>
<li>Loading and saving of the model from or in a file (methods <em>Load</em> and <em>Save</em>)</li>
<li>Closing and removal of the model from memory (method <em>Close</em>)</li>
<li>Definition of the full file name of the persistence storage for this model (method <em>GetFile</em>)</li>
<li>Tools to organize data objects in partitions and iterate on objects (methods <em>GetObjects</em>, <em>GetMainPartition</em>, <em>GetChildren</em>, <em>getPartition</em>, <em>getElementPartition</em>)</li>
<li>Mechanism to give unique names to model objects</li>
<li>Copy (<em>clone</em>) of the model (methods <em>NewEmpty</em> and <em>Paste</em>)</li>
<li>Support of earlier model formats for proper conversion of a model loaded from a file written by a previous version of the application (methods <em>GetFormatVersion</em> and <em>SetFormatVersion</em>)</li>
<li>Interface to check and update the model if necessary (method <em>Update</em>)</li>
<li>Support of several data models in one application. For this feature use OCAF multi-transaction manager, unique names and GUIDs of the data model (methods <em>GetModelName</em>, <em>GetGUID</em>)</li>
</ul>
<h2><a class="anchor" id="occt_tobj_2_3"></a>
Model Persistence</h2>
<p>The persistent representation of any OCAF model is contained in an XML or a binary file, which is defined by the format string returned by the method <em>GetFormat</em>. The default implementation works with a binary OCAF document format (<em>BinOcaf</em>). The other available format is <em>XmlOcaf</em>. The class <b><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a></b> declares and provides a default implementation of two virtual methods:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> Load (<span class="keyword">const</span> <span class="keywordtype">char</span>* theFile); </div><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> SaveAs (<span class="keyword">const</span> <span class="keywordtype">char</span>* theFile); </div></div><!-- fragment --><p>which retrieve and store the model from or in the OCAF file. The descendants should define the following protected method to support Load and Save operations:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> initNewModel (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> IsNew); </div></div><!-- fragment --><p>This method is called by <em>Load</em> after creation of a new model or after its loading from the file; its purpose is to perform the necessary initialization of the model (such as creation of necessary top-level partitions, model update due to version changes etc.). Note that if the specified file does not exist, method <em>Load</em> will create a new document and call <em>initNewModel</em> with the argument <b>True</b>. If the file has been normally loaded, the argument <b>False</b> is passed. Thus, a new empty <em>TObj</em> model is created by calling <em>Load</em> with an empty string or the path to a nonexistent file as argument.</p>
<p>The method <em>Load</em> returns <b>True</b> if the model has been retrieved successfully (or created a new), or <b>False</b> if the model could not be loaded. If no errors have been detected during initialization (model retrieval or creation), the virtual method <em>AfterRetrieval</em> is invoked for all objects of the model. This method initializes or updates the objects immediately after the model initialization. It could be useful when some object data should be imported from an OCAF attribute into transient fields which could be changed outside of the OCAF transaction mechanism. Such fields can be stored into OCAF attributes for saving into persistent storage during the save operation.</p>
<p>To avoid memory leaks, the <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a></em> class destructor invokes <em>Close</em> method which clears the OCAF document and removes all data from memory before the model is destroyed.</p>
<p>For XML and binary persistence of the <em>TObj</em> data model the corresponding drivers are implemented in <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_bin_l_drivers.html">BinLDrivers</a></em>, <em>BinMObj</em> and <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_xml_l_drivers.html">XmlLDrivers</a></em>, <em>XmlMObj</em> packages. These packages contain retrieval and storage drivers for the model, model objects and custom attributes from the <em>TObj</em> package. The schemas support persistence for the standard OCAF and <em>TObj</em> attributes. This is sufficient for the implementation of simple data models, but in some cases it can be reasonable to add specific OCAF attributes to facilitate the storage of the data specific to the application. In this case the schema should be extended using the standard OCAF mechanism.</p>
<h2><a class="anchor" id="occt_tobj_2_4"></a>
Access to the objects in the model</h2>
<p>All objects in the model are stored in the main partition and accessed by iterators. To access all model objects use:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object_iterator.html">TObj_ObjectIterator</a>) GetObjects () <span class="keyword">const</span>; </div></div><!-- fragment --><p>This method returns a recursive iterator on all objects stored in the model.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object_iterator.html">TObj_ObjectIterator</a>) GetChildren () <span class="keyword">const</span>; </div></div><!-- fragment --><p>This method returns an iterator on child objects of the main partition. Use the following method to get the main partition:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___partition.html">TObj_Partition</a>) GetMainPartition() <span class="keyword">const</span>; </div></div><!-- fragment --><p>To receive the iterator on objects of a specific type <em>AType</em> use the following call:</p>
<div class="fragment"><div class="line">GetMainPartition()-&amp;gt;GetChildren(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_8hxx.html#aea8b57a4fa80060017fe460aab588ed8">STANDARD_TYPE</a>(AType) ); </div></div><!-- fragment --><p>The set of protected methods is provided for descendant classes to deal with partitions:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___partition.html">TObj_Partition</a>) getPartition (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a>, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a>  theHidden) <span class="keyword">const</span>; </div></div><!-- fragment --><p>This method returns (creating if necessary) a partition in the specified label of the document. The partition can be created as hidden (<em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___hidden_partition.html">TObj_HiddenPartition</a></em> class). A hidden partition can be useful to distinguish the data that should not be visible to the user when browsing the model in the application.</p>
<p>The following two methods allow getting (creating) a partition in the sub-label of the specified label in the document (the label of the main partition for the second method) and with the given name:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___partition.html">TObj_Partition</a>) getPartition (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a>, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theIndex, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___extended_string.html">TCollection_ExtendedString</a>&amp; theName, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a>  theHidden) <span class="keyword">const</span>; </div><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___partition.html">TObj_Partition</a>) getPartition (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theIndex, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___extended_string.html">TCollection_ExtendedString</a>&amp; theName, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a>  theHidden) <span class="keyword">const</span>; </div></div><!-- fragment --><p>If the default object naming and the name register mechanism is turned on, the object can be found in the model by its unique name:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>) FindObject (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>)&amp; theName, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_name_container.html">TObj_TNameContainer</a>)&amp; theDictionary) <span class="keyword">const</span>; </div></div><!-- fragment --><h2><a class="anchor" id="occt_tobj_2_5"></a>
Own model data</h2>
<p>The model object can store its own data in the Data label of its main partition, however, there is no standard API for setting and getting these data types. The descendants can add their own data using standard OCAF methods. The enumeration DataTag is defined in <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a></em> to avoid conflict of data labels used by this class and its descendants, similarly to objects (see below).</p>
<h2><a class="anchor" id="occt_tobj_2_6"></a>
Object naming</h2>
<p>The basic implementation of <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a></em> provides the default naming mechanism: all objects must have unique names, which are registered automatically in the data model dictionary. The dictionary is a <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_name_container.html">TObj_TNameContainer</a></em> attribute whose instance is located in the model root label. If necessary, the developer can add several dictionaries into the specific partitions, providing the name registration in the correct name dictionary and restoring the name map after document is loaded from file. To ignore name registering it is necessary to redefine the methods <em>SetName</em>, <em>AfterRetrieval</em> of the <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> class and skip the registration of the object name. Use the following methods for the naming mechanism:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> IsRegisteredName (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>)&amp; theName, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_name_container.html">TObj_TNameContainer</a>)&amp; theDictionary ) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns <b>True</b> if the object name is already registered in the indicated (or model) dictionary.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> RegisterName (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>)&amp; theName, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a>&amp; theLabel, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_name_container.html">TObj_TNameContainer</a>)&amp; theDictionary ) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Registers the object name with the indicated label where the object is located in the OCAF document. Note that the default implementation of the method <em>SetName</em> of the object registers the new name automatically (if the name is not yet registered for any other object)</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> UnRegisterName (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>)&amp; theName, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_name_container.html">TObj_TNameContainer</a>)&amp; theDictionary ) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Unregisters the name from the dictionary. Ther names of <em>TObj</em> model objects are removed from the dictionary when the objects are deleted from the model.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_name_container.html">TObj_TNameContainer</a>) GetDictionary() <span class="keyword">const</span>;</div></div><!-- fragment --><p>Returns a default instance of the model dictionary (located at the model root label). The default implementation works only with one dictionary. If there are a necessity to have more than one dictionary for the model objects, it is recommended to redefine the corresponding virtual method of <a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a> that returns the dictionary where names of objects should be registered.</p>
<h2><a class="anchor" id="occt_tobj_2_7"></a>
API for transaction mechanism</h2>
<p>Class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a></em> provides the API for transaction mechanism (supported by OCAF):</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> HasOpenCommand() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns True if a Command transaction is open</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> OpenCommand() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Opens a new command transaction.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> CommitCommand() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Commits the Command transaction. Does nothing If there is no open Command transaction.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> AbortCommand() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Aborts the Command transaction. Does nothing if there is no open Command transaction.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> IsModified() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns True if the model document has a modified status (has changes after the last save)</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> SetModified( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> ); </div></div><!-- fragment --><p>Changes the modified status by force. For synchronization of transactions within several <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a></em> documents use class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_doc_std___multi_transaction_manager.html">TDocStd_MultiTransactionManager</a></em>.</p>
<h2><a class="anchor" id="occt_tobj_28"></a>
Model format and version</h2>
<p>Class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a></em> provides the descendant classes with a means to control the format of the persistent file by choosing the schema used to store or retrieve operations.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___extended_string.html">TCollection_ExtendedString</a> GetFormat () <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns the string <em>TObjBin</em> or <em>TObjXml</em> indicating the current persistent mechanism. The default value is <em>TObjBin</em>. Due to the evolution of functionality of the developed application, the contents and the structure of its data model vary from version to version. <em>TObj</em> package provides a basic mechanism supporting backward versions compatibility, which means that newer versions of the application will be able to read Data Model files created by previous versions (but not vice-versa) with a minimum loss of data. For each type of Data Model, all known versions of the data format should be enumerated in increasing order, incremented with every change of the model format. The current version of the model format is stored in the model file and can be checked upon retrieval.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> GetFormatVersion() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns the format version stored in the model file</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> SetFormatVersion(<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theVersion); </div></div><!-- fragment --><p>Defines the format version used for save.</p>
<p>Upon loading a model, the method <em>initNewModel()</em>, called immediately after opening a model from disk (on the level of the OCAF document), provides a specific code that checks the format version stored in that model. If it is older than the current version of the application, the data update can be performed. Each model can have its own specific conversion code that performs the necessary data conversion to make them compliant with the current version.</p>
<p>When the conversion ends the user is advised of that by the messenger interface provided by the model (see messaging chapter for more details), and the model version is updated. If the version of data model is not supported (it is newer than the current or too old), the load operation should fail. The program updating the model after version change can be implemented as static methods directly in C++ files of the corresponding Data Model classes, not exposing it to the other parts of the application. These codes can use direct access to the model and objects data (attributes) not using objects interfaces, because the data model API and object classes could have already been changed.</p>
<p>Note that this mechanism has been designed to maintain version compatibility for the changes of data stored in the model, not for the changes of low-level format of data files (such as the storage format of a specific OCAF attribute). If the format of data files changes, a specific treatment on a case-by-case basis will be required.</p>
<h2><a class="anchor" id="occt_tobj_2_9"></a>
Model update</h2>
<p>The following methods are used for model update to ensure its consistency with respect to the other models in case of cross-model dependencies:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> Update(); </div></div><!-- fragment --><p>This method is usually called after loading of the model. The default implementation does nothing and returns <b>True</b>.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> initNewModel( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> IsNew); </div></div><!-- fragment --><p>This method performs model initialization, check and updates (as described above).</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> updateBackReferences( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>)&amp; theObj); </div></div><!-- fragment --><p>This method is called from the previous method to update back references of the indicated object after the retrieval of the model from file (see data model - object relationship chapter for more details)</p>
<h2><a class="anchor" id="occt_tobj_2_10"></a>
Model copying</h2>
<p>To copy the model between OCAF documents use the following methods:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> Paste (<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a>) theModel, <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___relocation_table.html">TDF_RelocationTable</a>) theRelocTable = 0 ); </div></div><!-- fragment --><p>Pastes the current model to the new model. The relocation table ensures correct copying of the sub-data shared by several parts of the model. It stores a map of processed original objects of relevant types in their copies.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a>) NewEmpty() = 0; </div></div><!-- fragment --><p>Redefines a pure virtual method to create a new empty instance of the model.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> CopyReferences ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model.html">TObj_Model</a>)&amp; theTarget, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___relocation_table.html">TDF_RelocationTable</a>)&amp; theRelocTable); </div></div><!-- fragment --><p>Copies the references from the current model to the target model.</p>
<h2><a class="anchor" id="occt_tobj_2_11"></a>
Messaging</h2>
<p>The messaging is organised using Open CASCADE Messenger from the package <a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_message.html">Message</a>. The messenger is stored as the field of the model instance and can be set and retrieved by the following methods:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> SetMessenger( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_message___messenger.html">Message_Messenger</a>)&amp; ); </div><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_message___messenger.html">Message_Messenger</a>) Messenger() <span class="keyword">const</span>; </div></div><!-- fragment --><p>A developer should create his own instance of the Messenger bound to the application user interface, and attribute it to the model for future usage. In particular the messenger is used for reporting errors and warnings in the persistence mechanism. Each message has a unique string identifier (key). All message keys are stored in a special resource file TObj.msg. This file should be loaded at the start of the application by call to the appropriate method of the class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_message___msg_file.html">Message_MsgFile</a></em>.</p>
<h1><a class="anchor" id="occt_tobj_3"></a>
Model object</h1>
<p>Class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> provides basic interface and default implementation of important features of <em>TObj</em> model objects. This implementation defines basic approaches that are recommended for all descendants, and provides tools to facilitate their usage.</p>
<div class="image">
<img src="tobj_image005.png" alt="tobj_image005.png"/>
<div class="caption">
TObj objects hierarchy</div></div>
 <h2><a class="anchor" id="occt_tobj_3_1"></a>
Separation of data and interface</h2>
<p>In the <em>TObj</em> data model, the data are separated from the interfaces that manage them. The data belonging to a model object are stored in its root label and sub-labels in the form of standard OCAF attributes. This allows using standard OCAF mechanisms for work with these data, and eases the implementation of the persistence mechanism.</p>
<p>The instance of the interface which serves as an API for managing object data (e.g. represents the model object) is stored in the root label of the object, and typically does not bring its own data. The interface classes are organized in a hierarchy corresponding to the natural hierarchy of the model objects according to the application.</p>
<p>In the text below the term 'object' is used to denote either the instance of the interface class or the object itself (both interface and data stored in OCAF).</p>
<p>The special type of attribute <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_object.html">TObj_TObject</a></em> is used for storing instances of objects interfaces in the OCAF tree. <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_object.html">TObj_TObject</a></em> is a simple container for the object of type <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em>. All objects (interfaces) of the data model inherit this class.</p>
<div class="image">
<img src="tobj_image006.png" alt="tobj_image006.png"/>
<div class="caption">
TObj object stored on OCAF label</div></div>
<h2><a class="anchor" id="occt_tobj_3_2"></a>
Basic features</h2>
<p>The <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> class provides some basic features that can be inherited (or, if necessary, redefined) by the descendants:</p>
<ul>
<li>Gives access to the model to which the object belongs (method <em>GetModel</em>) and to the OCAF label in which the object is stored (method <em>GetLabel</em>).</li>
<li>Supports references (and back references) to other objects in the same or in another model (methods <em>getReference</em>, <em>setReference</em>, <em>addReference</em>, <em>GetReferences</em>, <em>GetBackReferences</em>, <em>AddBackReference</em>, <em>RemoveBackReference</em>, <em>ReplaceReference</em>)</li>
<li>Provides the ability to contain child objects, as it is actual for partition objects (methods <em>GetChildren</em>, <em>GetFatherObject</em>)</li>
<li>Organizes its data in the OCAF structure by separating the sub-labels of the main label intended for various kinds of data and providing tools to organize these data (see <a href="../../../../Documents%20and%20Settings/TEMP/obj-inher">below</a>). The kinds of data stored separately are:<ul>
<li>Child objects stored in the label returned by the method <em>GetChildLabel</em></li>
<li>References to other objects stored in the label returned by the method <em>GetReferenceLabel</em></li>
<li>Other data, both common to all objects and specific for each subtype of the model object, are stored in the label returned by the method <em>GetDataLabel</em></li>
</ul>
</li>
<li>Provides unique names of all objects in the model (methods <em>GetDictionary</em>, <em>GetName</em>, <em>SetName</em>)</li>
<li>Provides unified means to maintain persistence (implemented in descendants with the help of macros <em>DECLARE_TOBJOCAF_PERSISTENCE</em> and <em>IMPLEMENT_TOBJOCAF_PERSISTENCE</em>)</li>
<li>Allows an object to remove itself from the OCAF document and check the depending objects can be deleted according to the back references (method <em>Detach</em>)</li>
<li>Implements methods for identification and versioning of objects</li>
<li>Manages the object interaction with OCAF Undo/Redo mechanism (method <em>IsAlive</em>, <em>AfterRetrieval</em>, <em>BeforeStoring</em>)</li>
<li>Allows make a clone (methods <em>Clone</em>, <em>CopyReferences</em>, <em>CopyChildren</em>, <em>copyData</em>)</li>
<li>Contains additional word of bit flags (methods <em>GetFlags</em>, <em>SetFlags</em>, <em>TestFlags</em>, <em>ClearFlags</em>)</li>
<li>Defines the interface to sort the objects by rank (methods <em>GetOrder</em>, <em>SetOrder</em>)</li>
<li>Provides a number of auxiliary methods for descendants to set/get the standard attribute values, such as int, double, string, arrays etc.</li>
</ul>
<p>An object can be received from the model by the following methods:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> GetObj ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a>&amp; theLabel, <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>)&amp; theResObject, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> isSuper = Standard_False ); </div></div><!-- fragment --><p>Returns <em>True</em> if the object has been found in the indicated label (or in the upper level label if <em>isSuper</em> is <em>True</em>).</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>) GetFatherObject ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard___type.html">Standard_Type</a>)&amp; theType = NULL ) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns the father object of the indicated type for the current object (the direct father object if the type is NULL).</p>
<h2><a class="anchor" id="occt_tobj_3_3"></a>
Data layout and inheritance</h2>
<p>As far as the data objects are separated from the interfaces and stored in the OCAF tree, the functionality to support inheritance is required. Each object has its own data and references stored in the labels in the OCAF tree. All data are stored in the sub-tree of the main object label. If it is necessary to inherit a class from the base class, the descendant class should use different labels for data and references than its ancestor.</p>
<p>Therefore each <em>TObj</em> class can reserve the range of tags in each of <em>Data</em>, <em>References</em>, and <em>Child</em> sub-labels. The reserved range is declared by the enumeration defined in the class scope (called DataTag, RefTag, and ChildTag, respectively). The item <em>First</em> of the enumeration of each type is defined via the <em>Last</em> item of the corresponding enumeration of the parent class, thus ensuring that the tag numbers do not overlap. The item <em>Last</em> of the enumeration defines the last tag reserved by this class. Other items of the enumeration define the tags used for storing particular data items of the object. See the declaration of the <a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___partition.html">TObj_Partition</a> class for the example.</p>
<p><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> class provides a set of auxiliary methods for descendants to access the data stored in sub-labels by their tag numbers:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a> getDataLabel (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank1, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank2 = 0) <span class="keyword">const</span>; </div><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a> getReferenceLabel (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank1, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank2 = 0) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns the label in <em>Data</em> or <em>References</em> sub-labels at a given tag number (theRank1). The second argument, theRank2, allows accessing the next level of hierarchy (theRank2-th sub-label of theRank1-th data label). This is useful when the data to be stored are represented by multiple OCAF attributes of the same type (e.g. sequences of homogeneous data or references).</p>
<p>The get/set methods allow easily accessing the data located in the specified data label for the most widely used data types (<em>Standard_Real</em>, <em>Standard_Integer</em>, <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a></em>, <em>TColStd_HArray1OfReal</em>, <em>TColStd_HArray1OfInteger</em>, <em>TColStd_HArray1OfExtendedString</em>). For instance, methods provided for real numbers are:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#aef96be6ca3bae9762e592db2b356bc4c">Standard_Real</a> getReal (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank1, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank2 = 0) <span class="keyword">const</span>; </div><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> setReal (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#aef96be6ca3bae9762e592db2b356bc4c">Standard_Real</a> theValue, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank1, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank2 = 0, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#aef96be6ca3bae9762e592db2b356bc4c">Standard_Real</a> theTolerance = 0.) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Similar methods are provided to access references to other objects:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>) getReference (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank1, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank2 = 0) <span class="keyword">const</span>; </div><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> setReference (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>) &amp;theObject, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank1, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank2 = 0); </div></div><!-- fragment --><p>The method <em>addReference</em> gives an easy way to store a sequence of homogeneous references in one label.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a> addReference (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theRank1, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>) &amp;theObject); </div></div><!-- fragment --><p>Note that while references to other objects should be defined by descendant classes individually according to the type of object, <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> provides methods to manipulate (check, remove, iterate) the existing references in the uniform way, as described below.</p>
<h2><a class="anchor" id="occt_tobj_3_4"></a>
Persistence</h2>
<p>The persistence of the <em>TObj</em> Data Model is implemented with the help of standard OCAF mechanisms (a schema defining necessary plugins, drivers, etc.). This implies the possibility to store/retrieve all data that are stored as standard OCAF attributes., The corresponding handlers are added to the drivers for <em>TObj</em>-specific attributes.</p>
<p>The special tool is provided for classes inheriting from <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> to add the new types of persistence without regeneration of the OCAF schema. The class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___persistence.html">TObj_Persistence</a></em> provides basic means for that:</p>
<ul>
<li>automatic run-time registration of object types</li>
<li>creation of a new object of the specified type (one of the registered types)</li>
</ul>
<p>Two macros defined in the file <a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_t_obj___persistence_8hxx.html">TObj_Persistence.hxx</a> have to be included in the definition of each model object class inheriting <a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a> to activate the persistence mechanism:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_t_obj___persistence_8hxx.html#a0e19adfd8cbfb23f4c07eccf87bce623">DECLARE_TOBJOCAF_PERSISTENCE</a> (classname, ancestorname) </div></div><!-- fragment --><p>Should be included in the private section of declaration of each class inheriting <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> (hxx file). This macro adds an additional constructor to the object class, and declares an auxiliary (private) class inheriting <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___persistence.html">TObj_Persistence</a></em> that provides a tool to create a new object of the proper type.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_t_obj___persistence_8hxx.html#aeb1638c05cfdcd705bd2f00994b47ad4">IMPLEMENT_TOBJOCAF_PERSISTENCE</a> (classname) </div></div><!-- fragment --><p>Should be included in .cxx file of each object class that should be saved and restored. This is not needed for abstract types of objects. This macro implements the functions declared by the previous macro and creates a static member that automatically registers that type for persistence.</p>
<p>When the attribute <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_object.html">TObj_TObject</a></em> that contains the interface object is saved, its persistence handler stores the runtime type of the object class. When the type is restored the handler dynamically recognizes the type and creates the corresponding object using mechanisms provided by <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___persistence.html">TObj_Persistence</a></em>.</p>
<h2><a class="anchor" id="occt_tobj_3_5"></a>
Names of objects</h2>
<p>All <em>TObj</em> model objects have names by which the user can refer to the object. Upon creation, each object receives a default name, constructed from the prefix corresponding to the object type (more precisely, the prefix is defined by the partition to which the object belongs), and the index of the object in the current partition. The user has the possibility to change this name. The uniqueness of the name in the model is ensured by the naming mechanism (if the name is already used, it cannot be attributed to another object). This default implementation of <em>TObj</em> package works with a single instance of the name container (dictionary) for name registration of objects and it is enough in most simple projects. If necessary, it is easy to redefine a couple of object methods (for instance <em>GetDictionary</em>()) and to take care of construction and initialization of containers.</p>
<p>This functionality is provided by the following methods:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_name_container.html">TObj_TNameContainer</a>) GetDictionary() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns the name container where the name of object should be registered. The default implementation returns the model name container.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>) GetName() <span class="keyword">const</span>; </div><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> GetName( <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___extended_string.html">TCollection_ExtendedString</a>&amp; theName ) <span class="keyword">const</span>; </div><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> GetName( <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___ascii_string.html">TCollection_AsciiString</a>&amp; theName ) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns the object name. The methods with in / out argument return False if the object name is not defined.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> SetName ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>)&amp; theName ) <span class="keyword">const</span>; </div><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> SetName         ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_ascii_string.html">TCollection_HAsciiString</a>)&amp; theName ) <span class="keyword">const</span>; </div><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> SetName         ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#aee98bfe6774a1f4d9570c388805de3cc">Standard_CString</a> theName ) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Attributes a new name to the object and returns <b>True</b> if the name has been attributed successfully. Returns False if the name has been already attributed to another object. The last two methods are short-cuts to the first one.</p>
<h2><a class="anchor" id="occt_tobj_3_6"></a>
References between objects</h2>
<p>Class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> allows creating references to other objects in the model. Such references describe relations among objects which are not adequately reflected by the hierarchical objects structure in the model (parent-child relationship).</p>
<p>The references are stored internally using the attribute <a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_reference.html">TObj_TReference</a>. This attribute is located in the sub-label of the referring object (called <em>master</em>) and keeps reference to the main label of the referred object. At the same time the referred object can maintain the back reference to the master object.</p>
<div class="image">
<img src="tobj_image007.png" alt="tobj_image007.png"/>
<div class="caption">
Objects relationship</div></div>
<p>The back references are stored not in the OCAF document but as a transient field of the object; they are created when the model is restored from file, and updated automatically when the references are manipulated. The class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_reference.html">TObj_TReference</a></em> allows storing references between objects from different <em>TObj</em> models, facilitating the construction of complex relations between objects.</p>
<p>The most used methods for work with references are:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> HasReference( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>)&amp; theObject) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns True if the current object refers to the indicated object.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object_iterator.html">TObj_ObjectIterator</a>) GetReferences ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard___type.html">Standard_Type</a>)&amp; theType = NULL ) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns an iterator on the object references. The optional argument <em>theType</em> restricts the types of referred objects, or does not if it is NULL.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> RemoveAllReferences(); </div></div><!-- fragment --><p>Removes all references from the current object.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> RemoveReference( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>)&amp; theObject ); </div></div><!-- fragment --><p>Removes the reference to the indicated object.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object_iterator.html">TObj_ObjectIterator</a>) GetBackReferences ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_standard___type.html">Standard_Type</a>)&amp; theType = NULL ) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns an iterator on the object back references. The argument theType restricts the types of master objects, or does not if it is NULL.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> ReplaceReference  ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>)&amp; theOldObject,  <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>)&amp; theNewObject ); </div></div><!-- fragment --><p>Replaces the reference to theOldObject by the reference to <em>theNewObject</em>. The handle theNewObject may be NULL to remove the reference.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> RelocateReferences  ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a>&amp; theFromRoot,  <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a>&amp; theToRoot, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> theUpdateackRefs = Standard_True ); </div></div><!-- fragment --><p>Replaces all references to a descendant label of <em>theFromRoot</em> by the references to an equivalent label under <em>theToRoot</em>. Returns <b>False</b> if the resulting reference does not point at a <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em>. Updates back references if theUpdateackRefs is <b>True</b>.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> CanRemoveReference ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>)&amp; theObj) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns <b>True</b> if the reference can be removed and the master object will remain valid (<em>weak</em> reference). Returns <b>False</b> if the master object cannot be valid without the referred object (<em>strong</em> reference). This affects the behaviour of objects removal from the model &ndash; if the reference cannot be removed, either the referred object will not be removed, or both the referred and the master objects will be removed (depends on the deletion mode in the method <b>Detach</b>)</p>
<h2><a class="anchor" id="occt_tobj_3_7"></a>
Creation and deletion of objects</h2>
<p>It is recommended that all objects inheriting from <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> should implement the same approach to creation and deletion.</p>
<p>The object of the <em>TObj</em> data model cannot be created independently of the model instance, as far as it stores the object data in OCAF data structures. Therefore an object class cannot be created directly as its constructor is protected.</p>
<p>Instead, each object should provide a static method <em>Create</em>(), which accepts the model, with the label, which stores the object and other type-dependent parameters necessary for proper definition of the object. This method creates a new object with its data (a set of OCAF attributes) in the specified label, and returns a handle to the object's interface.</p>
<p>The method <em>Detach</em>() is provided for deletion of objects from OCAF model. Object data are deleted from the corresponding OCAF label; however, the handle on object remains valid. The only operation available after object deletion is the method <em>IsAlive</em>() checking whether the object has been deleted or not, which returns False if the object has been deleted.</p>
<p>When the object is deleted from the data model, the method checks whether there are any alive references to the object. Iterating on references the object asks each referring (master) object whether the reference can be removed. If the master object can be unlinked, the reference is removed, otherwise the master object will be removed too or the referred object will be kept alive. This check is performed by the method <em>Detach</em> , but the behavior depends on the deletion mode <em>TObj_DeletingMode</em>:</p>
<ul>
<li><b>TObj_FreeOnly</b> &ndash; the object will be destroyed only if it is free, i.e. there are no references to it from other objects</li>
<li><b>TObj_KeepDepending</b> &ndash; the object will be destroyed if there are no strong references to it from master objects (all references can be unlinked)</li>
<li><b>TObj_Force</b> &ndash; the object and all depending master objects that have strong references to it will be destroyed.</li>
</ul>
<p>The most used methods for object removing are:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> CanDetachObject (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_t_obj___deleting_mode_8hxx.html#aed0e599bad914b56a4640cbe36f2613c">TObj_DeletingMode</a> theMode = TObj_FreeOnly ); </div></div><!-- fragment --><p>Returns <b>True</b> if the object can be deleted with the indicated deletion mode.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> Detach ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_t_obj___deleting_mode_8hxx.html#aed0e599bad914b56a4640cbe36f2613c">TObj_DeletingMode</a> theMode = TObj_FreeOnly ); </div></div><!-- fragment --><p>Removes the object from the document if possible (according to the indicated deletion mode). Unlinks references from removed objects. Returns <b>True</b> if the objects have been successfully deleted.</p>
<h2><a class="anchor" id="occt_tobj_3_8"></a>
Transformation and replication of object data</h2>
<p><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> provides a number of special virtual methods to support replications of objects. These methods should be redefined by descendants when necessary.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>) Clone (<span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a>&amp; theTargetLabel, <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___relocation_table.html">TDF_RelocationTable</a>) theRelocTable = 0); </div></div><!-- fragment --><p>Copies the object to theTargetLabel. The new object will have all references of its original. Returns a handle to the new object (null handle if fail). The data are copied directly, but the name is changed by adding the postfix *_copy*. To assign different names to the copies redefine the method:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>) GetNameForClone ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>)&amp; ) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns the name for a new object copy. It could be useful to return the same object name if the copy will be in the other model or in the other partition with its own dictionary. The method <em>Clone</em> uses the following public methods for object data replications:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> CopyReferences (<span class="keyword">const</span> <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a>)&amp; theTargetObject, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___relocation_table.html">TDF_RelocationTable</a>) theRelocTable); </div></div><!-- fragment --><p>Adds to the copy of the original object its references.</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <span class="keywordtype">void</span> CopyChildren (<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a>&amp; theTargetLabel, <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___relocation_table.html">TDF_RelocationTable</a>) theRelocTable); </div></div><!-- fragment --><p>Copies the children of an object to the target child label.</p>
<h2><a class="anchor" id="occt_tobj_3_9"></a>
Object flags</h2>
<p>Each instance of <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> stores a set of bit flags, which facilitate the storage of auxiliary logical information assigned to the objects (object state). Several typical state flags are defined in the enumeration <em>ObjectState</em>:</p>
<ul>
<li><em>ObjectState_Hidden</em> &ndash; the object is marked as hidden</li>
<li><em>ObjectState_Saved</em> &ndash; the object has (or should have) the corresponding saved file on disk</li>
<li><em>ObjectState_Imported</em> &ndash; the object is imported from somewhere</li>
<li><em>ObjectState_ImportedByFile</em> &ndash; the object has been imported from file and should be updated to have correct relations with other objects</li>
<li><em>ObjectState_Ordered</em> &ndash; the partition contains objects that can be ordered.</li>
</ul>
<p>The user (developer) can define any new flags in descendant classes. To set/get an object, the flags use the following methods:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> GetFlags() <span class="keyword">const</span>; </div><div class="line"><span class="keywordtype">void</span> SetFlags( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theMask ); </div><div class="line">Stadnard_Boolean TestFlags( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theMask ) <span class="keyword">const</span>; </div><div class="line"><span class="keywordtype">void</span> ClearFlags( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theMask = 0 ); </div></div><!-- fragment --><p>In addition, the generic virtual interface stores the logical properties of the object class in the form of a set of bit flags. Type flags can be received by the method:</p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> GetTypeFlags() <span class="keyword">const</span>; </div></div><!-- fragment --><p>The default implementation returns the flag <b>Visible</b> defined in the enumeration <em>TypeFlags</em>. This flag is used to define visibility of the object for the user browsing the model (see class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___hidden_partition.html">TObj_HiddenPartition</a></em>). Other flags can be added by the applications.</p>
<h2><a class="anchor" id="occt_tobj_310"></a>
Partitions</h2>
<p>The special kind of objects defined by the class <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___partition.html">TObj_Partition</a></em> (and its descendant <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___hidden_partition.html">TObj_HiddenPartition</a></em>) is provided for partitioning the model into a hierarchical structure. This object represents the container of other objects. Each <em>TObj</em> model contains the main partition that is placed in the same OCAF label as the model object, and serves as a root of the object's tree. A hidden partition is a simple partition with a predefined hidden flag.</p>
<p>The main partition object methods:</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_d_f___label.html">TDF_Label</a> NewLabel() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Allocates and returns a new label for creation of a new child object.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> SetNamePrefix  ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>)&amp; thePrefix); </div></div><!-- fragment --><p>Defines the prefix for automatic generation of names of the newly created objects.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>) GetNamePrefix() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns the current name prefix.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___handle_8hxx.html#a464f2f86d5d805f03f4e3c9beb007e40">Handle</a>(<a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_collection___h_extended_string.html">TCollection_HExtendedString</a>) GetNewName ( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a03b92feca37cfb9c80cb41a5f6df6cef">Standard_Boolean</a> theIsToChangeCount) <span class="keyword">const</span>; </div></div><!-- fragment --><p>Generates the new name and increases the internal counter of child objects if theIsToChangeCount is <b>True</b>.</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> GetLastIndex() <span class="keyword">const</span>; </div></div><!-- fragment --><p>Returns the last reserved child index.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> SetLastIndex( <span class="keyword">const</span> <a class="codeRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/_standard___type_def_8hxx.html#a844729aed1c6f9f5aadd6d4e9ddd5984">Standard_Integer</a> theIndex ); </div></div><!-- fragment --><p>Sets the last reserved index.</p>
<h1><a class="anchor" id="occt_tobj_4"></a>
Auxiliary classes</h1>
<p>Apart from the model and the object, package <em>TObj</em> provides a set of auxiliary classes:</p>
<ul>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___application.html">TObj_Application</a></em> &ndash; defines OCAF application supporting existence and operation with <em>TObj</em> documents.</li>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___assistant.html">TObj_Assistant</a></em> &ndash; class provides an interface to the static data to be used during save and load operations on models. In particular, in case of cross-model dependencies it allows passing information on the parent model to the OCAF loader to correctly resolve the references when loading a dependent model.</li>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_reference.html">TObj_TReference</a></em> &ndash; OCAF attribute describes the references between objects in the <em>TObj</em> model(s). This attribute stores the label of the referred model object, and provides transparent cross-model references. At runtime, these references are simple Handles; in persistence mode, the cross-model references are automatically detected and processed by the persistence mechanism of <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___t_reference.html">TObj_TReference</a></em> attribute.</li>
<li>Other classes starting with <em>TObj_T...</em> &ndash; define OCAF attributes used to store TObj-specific classes and some types of data on OCAF labels.</li>
<li>Iterators &ndash; a set of classes implementing <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object_iterator.html">TObj_ObjectIterator</a></em> interface, used for iterations on <em>TObj</em> objects:<ul>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object_iterator.html">TObj_ObjectIterator</a></em> &ndash; a basic abstract class for other <em>TObj</em> iterators. Iterates on <em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___object.html">TObj_Object</a></em> instances.</li>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___label_iterator.html">TObj_LabelIterator</a></em> &ndash; iterates on object labels in the <em>TObj</em> model document</li>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___model_iterator.html">TObj_ModelIterator</a></em> &ndash; iterates on all objects in the model. Works with sequences of other iterators.</li>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___ocaf_object_iterator.html">TObj_OcafObjectIterator</a></em> &ndash; Iterates on <em>TObj</em> data model objects. Can iterate on objects of a specific type.</li>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___reference_iterator.html">TObj_ReferenceIterator</a></em> &ndash; iterates on object references.</li>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___sequence_iterator.html">TObj_SequenceIterator</a></em> &ndash; iterates on a sequence of <em>TObj</em> objects.</li>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_t_obj___check_model.html">TObj_CheckModel</a></em> &ndash; a tool that checks the internal consistency of the model. The basic implementation checks only the consistency of references between objects.</li>
</ul>
</li>
</ul>
<p>The structure of <em>TObj</em> iterators hierarchy is presented below:</p>
<div class="image">
<img src="tobj_image008.png" alt="tobj_image008.png"/>
<div class="caption">
Hierarchy of iterators</div></div>
<h1><a class="anchor" id="occt_tobj_5"></a>
Packaging</h1>
<p>The <em>TObj</em> sources are distributed in the following packages:</p>
<ul>
<li><em>TObj</em> &ndash; defines basic classes that implement <em>TObj</em> interfaces for OCAF-based modelers.</li>
<li><em><a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_bin_l_drivers.html">BinLDrivers</a>, <a class="elRef" doxygen="C:/builds/OCCT-740_OCCT-740/Windows-64-VC10-opt/OCCT/doc/refman/OCCT.tag:../../refman/html/" href="../../refman/html/class_xml_l_drivers.html">XmlLDrivers</a></em> &ndash; binary and XML driver of <em>TObj</em> package</li>
<li><em>BinLPlugin, XmlLPlugin</em> &ndash; plug-in for binary and XML persistence</li>
<li><em>BinMObj, XmlMObj</em> &ndash; binary and XML drivers to store and retrieve specific <em>TObj</em> data to or from OCAF document</li>
<li><em>TKBinL, TKXmlL</em> &ndash; toolkits of binary and XML persistence </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Sep 26 2019 18:39:16 for Open CASCADE Technology by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
